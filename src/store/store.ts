import {combineReducers, createStore} from 'redux'
import {maxNumReducer} from './maxNum-reducer/maxNum-reducer'
import {minNumReducer} from './minNum-reducer/minNum-reducer'
import {numReducer} from './num-reducer/num-reducer'
import {loadState, saveState} from './localStorage'
import {throttle} from 'lodash'

//========================================================================================
// üé≤ .T.Y.P.E.S.

export type StateType = ReturnType<typeof rootReducer>

//========================================================================================
// üíæ .S.T.O.R.E.

const rootReducer = combineReducers({
    maxNum: maxNumReducer,
    minNum: minNumReducer,
    num: numReducer
})

// –¥–ª—è localStorage
const persistedState = loadState()

export const store = createStore(
    rootReducer,


    // –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ localStorage
    persistedState
)


// –¥–ª—è localStorage
// Throttle - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å—é.
store.subscribe(throttle(() => {
    saveState(store.getState())
}, 1000))

// @ts-ignore
window.store = store

/*

const persistedState = loadState();: –ó–¥–µ—Å—å –º—ã –≤—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é loadState(), –∫–æ—Ç–æ—Ä–∞—è –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–≤–ª–µ—á—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ localStorage.
–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ï—Å–ª–∏ –≤ localStorage –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –æ–Ω–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏
–ø—Ä–∏—Å–≤–æ–µ–Ω–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π persistedState.

const store = createStore(rootReducer, persistedState);: –ó–∞—Ç–µ–º –º—ã —Å–æ–∑–¥–∞–µ–º Redux-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ createStore, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ
—Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∏–∑ localStorage —Å–æ—Å—Ç–æ—è–Ω–∏–µ persistedState.

store.subscribe(throttle(() => { saveState(store.getState()); }, 1000));: –ó–¥–µ—Å—å –º—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ subscribe.
–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redux-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è. –û–¥–Ω–∞–∫–æ, —á—Ç–æ–±—ã –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤
localStorage —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –≤ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏), –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é throttle –∏–∑ lodash, —á—Ç–æ–±—ã
–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, —Ñ—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ 1000 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥,
—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∏–∑–±–µ–∂–∞—Ç—å —á—Ä–µ–∑–º–µ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è localStorage.

–§—É–Ω–∫—Ü–∏—è saveState(store.getState()) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ throttle, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ –Ω–µ–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Redux-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
—Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ Redux-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage —Å —É—á–µ—Ç–æ–º –∑–∞–¥–∞–Ω–Ω–æ–π —á–∞—Å—Ç–æ—Ç—ã –≤—ã–∑–æ–≤–æ–≤.





* */

